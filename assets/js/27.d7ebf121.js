(window.webpackJsonp=window.webpackJsonp||[]).push([[27],{76:function(t,s,a){"use strict";a.r(s);var r=a(0),e=Object(r.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"杂项"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#杂项"}},[t._v("#")]),t._v(" 杂项")]),t._v(" "),a("h2",{attrs:{id:"pm2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#pm2"}},[t._v("#")]),t._v(" PM2")]),t._v(" "),a("p",[t._v("文档地址："),a("a",{attrs:{href:"https://pm2.keymetrics.io/docs/usage/quick-start/",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://pm2.keymetrics.io/docs/usage/quick-start/"),a("OutboundLink")],1)]),t._v(" "),a("h3",{attrs:{id:"主要命令"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#主要命令"}},[t._v("#")]),t._v(" 主要命令")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("pm2 "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("ls")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 查看所有app")]),t._v("\npm2 restart all "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 重启所有app")]),t._v("\npm2 restart "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("app-name"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 重启指定app")]),t._v("\npm2 logs "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 查看log")]),t._v("\npm2 logs "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("app-name"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 查看指定app log")]),t._v("\npm2 flush "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 清空log")]),t._v("\npm2 delete "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("app-name"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 删除app")]),t._v("\n\npm2 start app.js --watch "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 启动app.js，代码有更新自动重启app")]),t._v("\npm2 start app.js --watch --ignore-watch"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"node_modules"')]),t._v("\npm2 start app.js --name my-api "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 命名app")]),t._v("\npm2 start pm2.config.js --only api-"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("env"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 根据配置文件启动app, env can be `development`, `test`, `staging`, `production`")]),t._v("\n")])])]),a("h3",{attrs:{id:"其他命令"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#其他命令"}},[t._v("#")]),t._v(" 其他命令")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("pm2 update "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 用于更新pm2之后更新内存中的pm2")]),t._v("\n")])])]),a("h3",{attrs:{id:"pm2-config-js"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#pm2-config-js"}},[t._v("#")]),t._v(" pm2.config.js")]),t._v(" "),a("p",[t._v("文档地址："),a("a",{attrs:{href:"https://pm2.keymetrics.io/docs/usage/application-declaration/",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://pm2.keymetrics.io/docs/usage/application-declaration/"),a("OutboundLink")],1)]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" envs "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'development'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'test'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'staging'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'production'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\nmodule"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  apps"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v("envs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("map")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("it")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      name"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'api-'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" it"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      instances"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      script"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'index.js'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      args"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      cwd"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'./'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      exec_mode"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'cluster_mode'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      env"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("NODE_APP_INSTANCE")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("''")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("NODE_ENV")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" it\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("h2",{attrs:{id:"cronjob"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#cronjob"}},[t._v("#")]),t._v(" Cronjob")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://crontab.guru/",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://crontab.guru/"),a("OutboundLink")],1)]),t._v(" "),a("p",[t._v("常用格式")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("* * * * * node /path/to/app.js "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" /var/log/app.log "),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("2")]),t._v(">")]),a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("&1")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 每分钟执行一次")]),t._v("\n*/5 * * * * "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 每5分钟执行一次")]),t._v("\n*/30 * * * * "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 每30分钟执行一次")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" */1 * * * "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 每小时执行一次")]),t._v("\n*/10 "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("6")]),t._v("-22 * * * "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 6点到22点每10分钟执行一次")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("45")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),t._v(" * * * "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 每天5:45分执行一次")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(" * * "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 每周一2:00执行一次")]),t._v("\n")])])]),a("h2",{attrs:{id:"supervisor"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#supervisor"}},[t._v("#")]),t._v(" Supervisor")]),t._v(" "),a("p",[a("a",{attrs:{href:"http://supervisord.org/",target:"_blank",rel:"noopener noreferrer"}},[t._v("http://supervisord.org/"),a("OutboundLink")],1)]),t._v(" "),a("h3",{attrs:{id:"常用命令"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#常用命令"}},[t._v("#")]),t._v(" 常用命令")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("supervisorctl "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("clear")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("name"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 清除指定app的log")]),t._v("\nsupervisorctl "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("clear")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("name"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("name"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 清除指定多个app的log")]),t._v("\nsupervisorctl "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("clear")]),t._v(" all "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 清除所有app的log")]),t._v("\nsupervisorctl status "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 查看所有app状态")]),t._v("\nsupervisorctl status "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("name"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 查看指定app状态")]),t._v("\nsupervisorctl update "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 更新配置并重启app")]),t._v("\nsupervisorctl restart "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("name"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 重启app. Note: restart does not reread config files")]),t._v("\nsupervisorctl restart "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("gname"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(":* "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 重启group里面的app. Note: restart does not reread config files")]),t._v("\nsupervisorctl restart "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("name"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("name"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 重启多个app")]),t._v("\nsupervisorctl restart all "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 重启所有app. Note: restart does not reread config files")]),t._v("\nsupervisorctl start "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("name"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 启动指定app. 其他命令格式类似restart")]),t._v("\nsupervisorctl stop "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("name"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 停止指定app. 其他命令格式类似restart")]),t._v("\nsupervisorctl reload "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 重启supervisord")]),t._v("\n")])])]),a("h3",{attrs:{id:"示例文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#示例文件"}},[t._v("#")]),t._v(" 示例文件")]),t._v(" "),a("div",{staticClass:"language-conf extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("[program:xiaoke_api]\ncommand=/opt/apps/xiaoke/api\nautostart=true\nautorestart=true\nstartretries=5\nuser=root\ndirectory=/opt/apps/xiaoke/\nredirect_stderr=true\nstdout_logfile=/var/log/xiaoke-api.log\nstdout_logfile_maxbytes=500MB\nstdout_logfile_backups=3\n\n[program:xiaoke_worker]\nnumprocs=2\ncommand=/opt/apps/xiaoke/xiaoke_worker\nprocess_name=%(program_name)s_%(process_num)02d\nautostart=true\nautorestart=true\nstartretries=5\nuser=root\ndirectory=/opt/apps/xiaoke/\nredirect_stderr=true\nstdout_logfile=/var/log/xiaoke-worker.log\nstdout_logfile_maxbytes=500MB\nstdout_logfile_backups=3\n\n[group:xiaoke_app]\nprograms=xiaoke_api,xiaoke_worker\n")])])])])}),[],!1,null,null,null);s.default=e.exports}}]);